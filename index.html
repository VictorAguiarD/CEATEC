<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />

<title>Gestor de OS & Clientes</title>

<link rel="stylesheet" href="style.css">
<link rel="icon" href="436207641_413482584829712_134768220458855204_n.ico">

<!--
  Carregando AMBAS as bibliotecas de importa√ß√£o com 'defer'.
  - SheetJS (xlsx.full.min.js) para arquivos .xlsx e .xls
  - PapaParse (papaparse.min.js) para arquivos .csv
  Isso garante que elas carreguem antes do nosso script.js.
-->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.1/dist/xlsx.full.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" defer></script>
<script src="script.js" defer></script>

</head>
<body>

<header>
  <div class="brand">
    <div class="logo">CT</div>
    <div>
      <h1>CeaTec</h1>
      <p class="sub">Gest√£o de ordem de servi√ßo</p>
    </div>
  </div>

  <div class="top-actions">
    <input id="fileImport" class="file-input" type="file" accept=".xlsx,.xls,.csv" />
    <button id="importBtn" class="ghost">Importar (XLSX/CSV )</button>
    <button id="exportXlsxBtn">Exportar XLSX</button>
    <button id="exportCsvBtn" class="ghost">Exportar CSV</button>
    <button id="downloadJsonBtn" class="ghost">Exportar JSON</button>
  </div>
</header>

<div class="dashboard" id="dashboard">
  <div class="dash-card card-blue">
    <div class="dash-left">
      <div class="dash-title">Total Faturado</div>
      <div class="dash-value" id="dashTotal">R$ 0,00</div>
    </div>
    <div class="dash-icon" style="background:linear-gradient(135deg,#2b6ef6,#6ea8ff)">üí∞</div>
  </div>

  <div class="dash-card card-green">
    <div class="dash-left">
      <div class="dash-title">Total Recebido</div>
      <div class="dash-value" id="dashRecebido">R$ 0,00</div>
    </div>
    <div class="dash-icon" style="background:linear-gradient(135deg,#10b981,#6ee7b7)">‚úÖ</div>
  </div>

  <div class="dash-card card-yellow">
    <div class="dash-left">
      <div class="dash-title">Total Devendo</div>
      <div class="dash-value" id="dashDevendo">R$ 0,00</div>
    </div>
    <div class="dash-icon" style="background:linear-gradient(135deg,#f59e0b,#ffd87a)">‚è≥</div>
  </div>

  <div class="dash-card card-red">
    <div class="dash-left">
      <div class="dash-title">OS Ativas</div>
      <div class="dash-value" id="dashAtivas">0</div>
    </div>
    <div class="dash-icon" style="background:linear-gradient(135deg,#ef4444,#ff8a8a)">üìÇ</div>
  </div>
</div>

<div class="layout">
  <!-- Coluna do Formul√°rio -->
  <div class="card left-col" id="formCard">
    <h3 style="margin-top:0">Cadastro / Edi√ß√£o de OS</h3>

    <div style="display:flex;gap:8px;margin-bottom:8px;">
      <div style="flex:1">
        <label>Cliente</label>
        <input id="cliente" type="text" placeholder="Nome do cliente" />
      </div>
      <div style="width:140px">
        <label>Tipo Cliente</label>
        <select id="tipoCliente">
          <option value="15">15 dias</option>
          <option value="30">30 dias</option>
        </select>
      </div>
    </div>

    <div class="row" style="margin-bottom:8px;">
      <div class="col">
        <label>Data de Sa√≠da</label>
        <input id="dataSaida" type="date"/>
      </div>
      <div style="width:140px">
        <label>OS (manual)</label>
        <input id="osNumero" type="text" placeholder="Digite o n¬∫ da OS"/>
      </div>
    </div>

    <div style="margin-bottom:8px;">
      <label>Equipamento</label>
      <input id="equipamento" type="text" placeholder="Ex: Impressora, Notebook..." />
    </div>

    <div class="row" style="margin-bottom:8px;">
      <div style="width:120px">
        <label>Quantidade</label>
        <input id="quantidade" type="number" min="1" value="1"/>
      </div>
      <div style="flex:1">
        <label>Custo unit√°rio (R$)</label>
        <input id="custo" type="number" step="0.01" min="0" value="0.00" />
      </div>
      <div style="width:140px">
        <label>Total (R$)</label>
        <input id="total" type="text" readonly />
      </div>
    </div>

    <div class="row" style="gap:10px;margin-bottom:8px;">
      <div style="flex:1">
        <label>50% Sinal (R$)</label>
        <input id="sinal" type="text" readonly />
      </div>
      <div style="flex:1">
        <label>Parcela 1 (R$)</label>
        <input id="parcela1" type="text" readonly />
      </div>
      <div style="flex:1">
        <label>Parcela 2 (R$)</label>
        <input id="parcela2" type="text" readonly />
      </div>
    </div>

    <div class="row" style="gap:10px;margin-bottom:8px;">
      <div style="flex:1">
        <label>Data Parcelamento 1</label>
        <input id="dataParcela1" type="date" readonly/>
      </div>
      <div style="flex:1">
        <label>Data Parcelamento 2</label>
        <input id="dataParcela2" type="date" readonly/>
      </div>
    </div>

    <div style="display:flex;gap:8px;align-items:center;">
      <label style="margin:0;min-width:150px">Marcar sinal como pago?</label>
      <select id="pagamentoRealizado" style="width:120px">
        <option value="nao">N√£o</option>
        <option value="sim">Sim</option>
      </select>
      <div style="flex:1"></div>
    </div>

    <div class="actions">
      <button id="salvarBtn">Salvar</button>
      <button id="limparBtn" class="ghost">Limpar Formul√°rio</button>
      <button id="carregarBtn" class="ghost">Carregar Selecionado</button>
      <button id="duplicarBtn" class="ghost">Duplicar Selecionado</button>
      <button id="excluirBtn" class="red">Excluir Selecionado</button>
    </div>

    <div class="charts-row">
      <div class="chart-card">
        <strong>Resumo Faturamento</strong>
        <canvas id="chartFaturado"></canvas>
        <div class="note">Total de todas as OS.</div>
      </div>
      <div class="chart-card">
        <strong>Resumo Recebido</strong>
        <canvas id="chartRecebido"></canvas>
        <div class="note">Total recebido (soma parcelas pagas).</div>
      </div>
      <div class="chart-card">
        <strong>Resumo Devendo</strong>
        <canvas id="chartDevendo"></canvas>
        <div class="note">Soma dos valores ainda pendentes.</div>
      </div>
    </div>
  </div>

  <!-- Coluna da Tabela -->
  <div class="card right-col">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div class="muted">Lista de OS</div>
      <div class="flex-row">
        <div class="muted-block" style="font-size:13px">Backups: autom√°tico a cada 5 minutos</div>
      </div>
    </div>
    
    <div class="filter-bar">
        <div style="flex:1;">
            <label for="filtroCliente">Filtrar por Cliente</label>
            <input type="text" id="filtroCliente" placeholder="Nome do cliente...">
        </div>
        <div style="width:150px;">
            <label for="filtroOS">Filtrar por OS</label>
            <input type="text" id="filtroOS" placeholder="N√∫mero da OS...">
        </div>
        <div style="width:180px;">
            <label for="filtroData">Filtrar por Data Sa√≠da</label>
            <input type="date" id="filtroData">
        </div>
        <button id="limparFiltrosBtn" class="ghost">Limpar Filtros</button>
    </div>

    <div style="overflow:auto;max-height:520px">
      <table id="tableOS">
        <thead>
          <tr>
            <th>CLIENTE</th><th>DATA SA√çDA</th><th>DATA P1</th><th>DATA P2</th>
            <th>SINAL</th><th>P1</th><th>P2</th><th>EQUIP.</th><th>OS</th><th>QTD</th>
            <th>CUSTO</th><th>TOTAL</th><th>PAGOS</th><th>DEVENDO</th><th>TIPO</th><th>A√á√ïES</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
      <div class="muted">Observa√ß√£o: clique na linha para selecionar.</div>
      <div style="display:flex;gap:8px">
        <button id="clearAllBtn" class="red">Limpar Tudo</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Backups -->
<div id="modalBackups" style="display:none;position:fixed;inset:0;background:rgba(2,6,23,0.6);align-items:center;justify-content:center;padding:20px">
  <div style="width:100%;max-width:820px;background:white;border-radius:10px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.35)">
    <h3 style="margin-top:0">Gerenciar Backups</h3>
    <div id="backupsList"></div>
    <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
      <button id="fecharModalBtn" class="ghost">Fechar</button>
    </div>
  </div>
</div>

</body>
</html>
